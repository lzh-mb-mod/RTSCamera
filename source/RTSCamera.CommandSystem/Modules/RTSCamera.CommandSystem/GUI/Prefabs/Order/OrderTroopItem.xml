<Prefab>
  <Parameters>
    <Parameter Name="IsAlternativeLayout" DefaultValue="false"/>
  </Parameters>
  <Constants>
    <Constant Name="Troop.Icon.Width" BrushName="Order.Troop.Icon" BrushLayer="Default" BrushValueType="Width" MultiplyResult="0.35"/>
    <Constant Name="Troop.Icon.Height" BrushName="Order.Troop.Icon" BrushLayer="Default" BrushValueType="Height" MultiplyResult="0.35"/>

    <!-- Filter Brush Constants -->
    <Constant Name="FilterUnsetBrush"           Value="OrderOfBattle.Filter.Unset" />
    <Constant Name="SpearBrush"                 Value="OrderOfBattle.Filter.Spear" />
    <Constant Name="ShieldBrush"                Value="OrderOfBattle.Filter.Shield" />
    <Constant Name="ThrownBrush"                Value="OrderOfBattle.Filter.Thrown" />
    <Constant Name="HeavyBrush"                 Value="OrderOfBattle.Filter.Heavy" />
    <Constant Name="HighTierBrush"              Value="OrderOfBattle.Filter.HighTier" />
    <Constant Name="LowTierBrush"               Value="OrderOfBattle.Filter.LowTier" />

  </Constants>
  <Window>
    <!--Must fill space even when invisible-->
    <ButtonWidget Command.Click="ExecuteAction" CanAcceptEvents="@IsSelectable" Command.AlternateClick="..\..\OnEscape" DoNotPassEventsToChildren="true" WidthSizePolicy="Fixed" HeightSizePolicy="Fixed" SuggestedWidth="131" SuggestedHeight="223" MarginTop="30" MarginBottom="10">
      <Children>
        <!-- Highlight -->
        <OrderTroopItemBrushWidget DoNotAcceptEvents="true" WidthSizePolicy="StretchToParent" HeightSizePolicy="StretchToParent" RangedCardBrush="Order.Card.Highlight.Ranged" MeleeCardBrush="Order.Card.Highlight.Melee" HasAmmo="@IsAmmoAvailable" IsVisible="@IsSelectionHighlightActive"/>
        
        <OrderTroopItemBrushWidget UpdateChildrenStates="true" WidthSizePolicy="StretchToParent" HeightSizePolicy="StretchToParent" RangedCardBrush="Order.Card.Background.Ranged" MeleeCardBrush="Order.Card.Background.Melee" HasAmmo="@IsAmmoAvailable" CurrentMemberCount="@CurrentMemberCount" IsSelectable="@IsSelectable" IsSelected="@IsSelected" IsVisible="@IsValid" FormationClass="@OrderOfBattleFormationClass">
          <Children>

            <!--Formation Name-->
            <BrushWidget DoNotAcceptEvents="true" DoNotPassEventsToChildren="true" UpdateChildrenStates="true" HeightSizePolicy="Fixed" WidthSizePolicy="Fixed" SuggestedWidth="35" SuggestedHeight="30" HorizontalAlignment="Right" VerticalAlignment="Top" PositionYOffset="-5" MarginRight="10" Brush="OrderOfBattle.FormationTypeSelection.Dropdown" IsVisible="false">
              <Children>
                <TextWidget WidthSizePolicy="CoverChildren" HeightSizePolicy="CoverChildren" VerticalAlignment="Center" HorizontalAlignment="Center" Brush.FontSize="20" Text="@FormationName"/>
              </Children>
            </BrushWidget>

            <!-- Troop Type Icons and Troop Counts -->
            <ListPanel DataSource="{ActiveFormationClasses}" WidthSizePolicy="CoverChildren" HeightSizePolicy="CoverChildren" HorizontalAlignment="Left" MarginLeft="15" VerticalAlignment="Top" MarginTop="45" StackLayout.LayoutMethod="VerticalBottomToTop" >
              <ItemTemplate>

                <ListPanel WidthSizePolicy="CoverChildren" HeightSizePolicy="CoverChildren" HorizontalAlignment="Left" VerticalAlignment="Center" StackLayout.LayoutMethod="HorizontalLeftToRight">
                  <Children>
                    <OrderFormationClassVisualBrushWidget WidthSizePolicy="Fixed" HeightSizePolicy="Fixed" SuggestedWidth="!Troop.Icon.Width" SuggestedHeight="!Troop.Icon.Height" FormationClassValue="@FormationClassValue" Brush="Order.Troop.Icon" />
                    <TextWidget WidthSizePolicy="CoverChildren" HeightSizePolicy="CoverChildren" HorizontalAlignment="Center" VerticalAlignment="Center" Brush="Order.Troop.CountText" Brush.FontSize="24" IntText="@TroopCount" />
                  </Children>
                </ListPanel>

              </ItemTemplate>
            </ListPanel>

            <!-- Morale Status-->
            <ListPanel WidthSizePolicy="CoverChildren" HeightSizePolicy="CoverChildren" HorizontalAlignment="Left" MarginLeft="15" MarginTop="15" StackLayout.LayoutMethod="HorizontalLeftToRight">
              <Children>
                <Widget WidthSizePolicy="Fixed" HeightSizePolicy="Fixed" SuggestedWidth="30" SuggestedHeight="30" VerticalAlignment="Center" Sprite="General\Icons\Morale@2x"/>
                <TextWidget WidthSizePolicy="CoverChildren" HeightSizePolicy="CoverChildren" MarginTop="4" VerticalAlignment="Center" Brush="Order.Troop.CountText" Brush.FontSize="24" IntText="@Morale" IsVisible="@HaveTroops" />
              </Children>
            </ListPanel>

            <Widget WidthSizePolicy="StretchToParent" HeightSizePolicy="StretchToParent" IsHidden="*IsAlternativeLayout">
              <Children>
                <!-- Left Shortcut Info -->
                <ValueBasedVisibilityWidget WidthSizePolicy="CoverChildren" HeightSizePolicy="CoverChildren" HorizontalAlignment="Left" VerticalAlignment="Center" PositionYOffset="-5" PositionXOffset="115" IndexToWatch="@FormationIndex" IndexToBeVisible="3" WatchType="LessThanEqual">
                  <Children>
                    <Widget WidthSizePolicy="CoverChildren" HeightSizePolicy="CoverChildren" IsVisible="@ShowSelectionInputs">
                      <Children>
                        <InputKeyVisualWidget DataSource="{ApplySelectionKey}" WidthSizePolicy="Fixed" HeightSizePolicy="Fixed" SuggestedWidth="60" SuggestedHeight="60" KeyID="@KeyID" IsVisible="@IsVisible"/>
                      </Children>
                    </Widget>
                  </Children>
                </ValueBasedVisibilityWidget>
                
                <!-- Right Shortcut Info -->
                <ValueBasedVisibilityWidget WidthSizePolicy="CoverChildren" HeightSizePolicy="CoverChildren" HorizontalAlignment="Right" VerticalAlignment="Center" PositionYOffset="-5" PositionXOffset="-115" IndexToWatch="@FormationIndex" IndexToBeVisible="4" WatchType="BiggerThanEqual">
                  <Children>
                    <Widget WidthSizePolicy="CoverChildren" HeightSizePolicy="CoverChildren" IsVisible="@ShowSelectionInputs">
                      <Children>
                        <InputKeyVisualWidget DataSource="{ApplySelectionKey}" WidthSizePolicy="Fixed" HeightSizePolicy="Fixed" SuggestedWidth="60" SuggestedHeight="60" KeyID="@KeyID" IsVisible="@IsVisible"/>
                      </Children>
                    </Widget>
                  </Children>
                </ValueBasedVisibilityWidget>
              </Children>
            </Widget>

            <!-- Gamepad Shortcut Info -->
            <ListPanel WidthSizePolicy="CoverChildren" HeightSizePolicy="CoverChildren" HorizontalAlignment="Center" VerticalAlignment="Bottom" PositionYOffset="-215" StackLayout.LayoutMethod="VerticalBottomToTop" IsVisible="*IsAlternativeLayout">
              <Children>
                <ListPanel WidthSizePolicy="CoverChildren" HeightSizePolicy="CoverChildren" HorizontalAlignment="Center" IsVisible="@ShowSelectionInputs">
                  <Children>
                    <InputKeyVisualWidget DataSource="{ApplySelectionKey}" WidthSizePolicy="Fixed" HeightSizePolicy="Fixed" SuggestedWidth="35" SuggestedHeight="35" KeyID="@KeyID" IsVisible="@IsVisible"/>
                    <TextWidget WidthSizePolicy="CoverChildren" HeightSizePolicy="CoverChildren" VerticalAlignment="Center" Brush="Order.Item.ShortcutText" Brush.FontSize="16" Text="/"/>
                    <InputKeyVisualWidget DataSource="{ToggleSelectionKey}" WidthSizePolicy="Fixed" HeightSizePolicy="Fixed" SuggestedWidth="35" SuggestedHeight="35" KeyID="@KeyID" IsVisible="@IsVisible"/>
                    <TextWidget WidthSizePolicy="CoverChildren" HeightSizePolicy="CoverChildren" VerticalAlignment="Center" Brush="Order.Item.ShortcutText" Brush.FontSize="16" Text="@SelectionText"/>
                  </Children>
                </ListPanel>
              </Children>
            </ListPanel>

            <!-- Ammo Percentage -->
            <FillBarWidget WidthSizePolicy="Fixed" HeightSizePolicy="Fixed" SuggestedWidth="77" SuggestedHeight="3" HorizontalAlignment="Center" VerticalAlignment="Bottom" MarginBottom="14" FillWidget="FillWidget" MaxAmountAsFloat="1.0" InitialAmountAsFloat="@AmmoPercentage">
              <Children>
                <Widget Id="FillWidget" ClipContents="true" WidthSizePolicy="Fixed" HeightSizePolicy="StretchToParent" SuggestedWidth="77" Sprite="BlankWhiteSquare_9" Color="#00000000">
                  <Children>
                    <Widget WidthSizePolicy="Fixed" HeightSizePolicy="StretchToParent" SuggestedWidth="77" Sprite="Order\ranged_unit_troop_card_ammo_fillbar"/>
                  </Children>
                </Widget>
              </Children>
            </FillBarWidget>

            <!-- Captain Visual -->
            <Widget WidthSizePolicy="Fixed" HeightSizePolicy="Fixed" SuggestedWidth="70" SuggestedHeight="52" HorizontalAlignment="Left" VerticalAlignment="Bottom" PositionYOffset="-30" MarginLeft="15" IsVisible="@HasCaptain" UpdateChildrenStates="true">
              <Children>
                <ImageIdentifierWidget DataSource="{CaptainImageIdentifier}" WidthSizePolicy="StretchToParent" HeightSizePolicy="StretchToParent" MarginLeft="2" MarginRight="2" MarginTop="2" MarginBottom="2" AdditionalArgs="@AdditionalArgs" ImageId="@Id" TextureProviderName="@TextureProviderName" />
                <BrushWidget WidthSizePolicy="StretchToParent" HeightSizePolicy="StretchToParent" Brush="Order.Card.Captain.Frame" />
              </Children>
            </Widget>

            <!-- Filters -->
            <ListPanel DataSource="{ActiveFilters}" WidthSizePolicy="CoverChildren" HeightSizePolicy="CoverChildren" HorizontalAlignment="Right" VerticalAlignment="Bottom" MarginBottom="35" MarginRight="15" StackLayout.LayoutMethod="VerticalBottomToTop">
              <ItemTemplate>
                <OrderOfBattleFormationFilterVisualBrushWidget WidthSizePolicy="Fixed" HeightSizePolicy="Fixed" SuggestedWidth="20" SuggestedHeight="20" MarginBottom="5" FormationFilter="@FilterTypeValue" UnsetBrush="!FilterUnsetBrush" SpearBrush="!SpearBrush" ShieldBrush="!ShieldBrush" ThrownBrush="!ThrownBrush" HeavyBrush="!HeavyBrush" HighTierBrush="!HighTierBrush" LowTierBrush="!LowTierBrush" />
              </ItemTemplate>
            </ListPanel>

            <!-- Orders -->
            <Widget WidthSizePolicy="CoverChildren" HeightSizePolicy="CoverChildren" HorizontalAlignment="Center" VerticalAlignment="Bottom" >
              <Children>
                <ListPanel WidthSizePolicy="CoverChildren" HeightSizePolicy="Fixed" SuggestedHeight="50" PositionYOffset="30" StackLayout.LayoutMethod="HorizontalLeftToRight" >
                  <Children>
                    <IconBrushWidget Id="Icon" WidthSizePolicy="Fixed" HeightSizePolicy="Fixed" SuggestedWidth="30" SuggestedHeight="30" VerticalAlignment="Center" Brush="Order.Icon" IconBrush="Order.Icons.Square" IconID="@CurrentOrderIconId" />

                    <FormationMarkerTeamTypeBrushWidget Id="TeamTypeWidget" WidthSizePolicy="Fixed" HeightSizePolicy="Fixed" SuggestedHeight="30" SuggestedWidth="30" VerticalAlignment="Center" IsVisible="@HasTarget" Brush="FormationMarker.TeamType" TeamType="2">
                      <Children>
                        <IconBrushWidget WidthSizePolicy="StretchToParent" HeightSizePolicy="StretchToParent" Brush="Compass.Type.Base" IconBrush="Compass.Type.Icons" IconID="@CurrentTargetFormationType" />
                      </Children>
                    </FormationMarkerTeamTypeBrushWidget>

                  </Children>
                </ListPanel>
              </Children>
            </Widget>

          </Children>
        </OrderTroopItemBrushWidget>
      </Children>
    </ButtonWidget>
  </Window>
</Prefab>